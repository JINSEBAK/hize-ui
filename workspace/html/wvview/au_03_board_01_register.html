<!DOCTYPE html>
<html lang="ko">
    <head>
        @@include('../common/resources.html', { "type" : "user" })
    </head>
    <body class="bg-ashed">
        <div class="w-main">
            <!--header-->
            <header class="w-hd">
                <div class="inner no-title">
                    <div class="">
                        <button type="button" class="btn btn-icon" id="btnGoBack">
                            <span class="icon icon-back"></span>
                        </button>
                    </div>
                    <div class="">
                        <label class="btn btn-default btn-sm" for="photoAttachment">
                            이미지 첨부
                            <input type="file" accept="image/*;capture=camera" id="photoAttachment">
                        </label>
                        <button type="button" class="btn btn-default btn-sm" id="btnRegister">등록</button>
                    </div>
                </div>
            </header>
            <article>
                <div class="post-board post-form">
                    <form>
                        <div class="form-group in-remove">
                            <label for="" class="sr-only">제목</label>
                            <input type="text" class="form-control" placeholder="제목을 입력해주세요. (50자 이내)" maxlength="50" id="postTitle">
                            <span class="glyphicon glyphicon-remove-circle icon-remove"></span>
                        </div>
                        <div class="form-group">
                            <textarea class="form-control" placeholder="내용을 입력해주세요."></textarea>
                        </div>

                        <!-- 첨부 완료 후 표시 -->
                        <!-- CHECK! 몇개까지 첨부 & 표시 할 것인가 -->
                        <div class="form-group">
                            <label for="" class="">첨부 이미지</label>
                            <div class="attachment">
                                <div class="file">
                                    <span class="name">IMG-00000.jpg</span>
                                    <span class="glyphicon glyphicon-remove-circle"></span>
                                </div>
                                <div class="file">
                                    <span class="name">imageimage....12345678.jpg</span>
                                    <span class="glyphicon glyphicon-remove-circle"></span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </article>
        </div>

        @@include('../common/scripts.html')
        <script>
            $(document).ready(function() {

                $('#btnGoBack').on('click', function() {
                    callConfirm({
                        title: '글쓰기 화면에서 나가시겠습니까?',
                        description: '이 페이지를 벗어나면<br>입력한 내용은 저장되지 않습니다.'
                    }, function() {}, {
                        cancel: '취소',
                        confirm: '나가기'
                    });
                });
            
                // 제목 작성
                $('#postTitle').on('change keyup paste', function() {
                    if ( $(this).val().length > 0 ) {
                        $(this).parent().addClass('del');
                    } else {
                        $(this).parent().removeClass('del');
                    }
                });

                // 제목 삭제
                $('.icon-remove').on('click', function() {
                    $(this).prev('input').val('');
                    $(this).parent().removeClass('del');
                });

                // 용량 체크 
                $('#photoAttachment').on('change', function() {
                    checkUserImgSize();
                });

                // 등록
                $('#btnRegister').on('click', function() {
                    callAlert({
                        title: "등록한 글은<br>관리자 확인 후 게시됩니다."
                    });
                });

                $('.attachment .file').find('.glyphicon-remove-circle').on('click', function(event) {
                    $(this).parent('.file').remove();
                });
            });

            function checkUserImgSize() {
                const input = document.getElementById('photoAttachment');
                if (input.files && input.files[0]) {
                    const MAX_SIZE = 3 * 1024 * 1024;

                    if (input.files[0].size > MAX_SIZE) {
                        callAlert({
                            title: '첨부 이미지는<br>3MB를 넘을 수 없습니다.',
                        });
                        return;
                    }

                    var viewHtml = '';
                    viewHtml += '<div class="file">'
                            +       '<span class="name">' + input.files[0].name + '</span>'
                            +       '<span class="glyphicon glyphicon-remove-circle"></span>'
                            +   '</div>';

                    $('.attachment').append(viewHtml);

                    $('.attachment .file').find('.glyphicon-remove-circle').on('click', function(event) {
                        $(this).parent('.file').remove();
                    });

                }
            }
        </script>
    </body>
</html>